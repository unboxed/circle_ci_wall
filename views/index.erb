<!DOCTYPE html>
<html>
<head>
  <title>Circle CI Wall</title>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
  <style>
    .queued { background: rgb(125,125,75);  }
    .running { background: rgb(125,125,0); }
    .success, .fixed { background: green; }
    .failed { background: red; }
    .branch-result { display: inline-block; margin: 2px; width: 45%; }
  </style>
</head>
<body>
<h1>Circle CI WALL</h1>
<br/>
<% if @error %>
  <%= @error %>
<% else %>
  <% {master: @branches['master'], develop: @branches['develop'] }.each do |branch_name,branch_info| %>
    <% first = branch_info.first %>
    <% first = branch_info[1] if first['status'] == 'canceled' %>
    <% next unless first %>
    <% first = branch_info[2] if first['status'] == 'canceled' %>
    <% next unless first %>
    <% first = branch_info[3] if first['status'] == 'canceled' %>
    <% next unless first %>
    <div class="branch-result <%= first['status'] %>">
      <h2><%= branch_name %></h2>
      <img src="http://www.gravatar.com/avatar/<%= Digest::MD5.hexdigest(first['committer_email'].downcase).to_s %>>" /><%= first['committer_name'] %><br/>
      <a href="<%= first['build_url'] %>" target="_blank"><%= first['subject'] %></a>
    </div>
  <% end %>
  <% @branches.delete('master') %>
  <% @branches.delete('develop') %>
  <% @branches.each do |branch_name,branch_info| %>
    <% first = branch_info.first %>
    <% first = branch_info[1] if first['status'] == 'canceled' %>
    <% next unless first %>
    <% first = branch_info[2] if first['status'] == 'canceled' %>
    <% next unless first %>
    <% first = branch_info[3] if first['status'] == 'canceled' %>
    <% next unless first %>
    <div class="branch-result <%= first['status'] %>">
      <h2><%= branch_name %></h2>
      <img src="http://www.gravatar.com/avatar/<%= Digest::MD5.hexdigest(first['committer_email'].downcase).to_s %>>" /><%= first['committer_name'] %><br/>
      <a href="<%= first['build_url'] %>" target="_blank"><%= first['subject'] %></a>
    </div>
  <% end %>
<% end %>
</body>
</html>