<!DOCTYPE html>
<html>
<head>
  <title>Circle CI Wall</title>
  <link href="style.css" media="all" rel="stylesheet" type="text/css" />
</head>
<body>

<% if @error %>
  <%= @error %>
<% else %>
  <% {master: @branches['master'], develop: @branches['develop'] }.each do |branch_name,branch_info| %>
    <% next unless branch_info %>
    <% first = branch_info.first %>
    <% first = branch_info[1] if first['status'] == 'canceled' %>
    <% next unless first %>
    <% first = branch_info[2] if first['status'] == 'canceled' %>
    <% next unless first %>
    <% first = branch_info[3] if first['status'] == 'canceled' %>
    <% next unless first %>
    <div class="branch-result <%= first['status'] %>">
      <div class="blame">
        <img src="http://www.gravatar.com/avatar/<%= Digest::MD5.hexdigest(first['committer_email'].downcase).to_s %>>?s=128" />
      </div>
      <div class="commit-details">
        <h2><%= branch_name[0,50] %></h2>
        <a href="<%= first['build_url'] %>" target="_blank"><%= first['subject'][0,50] %></a>
      </div>
    </div>

  <% end %>

  <% @branches.tap{|b|b.delete('develop'); b.delete('master')}.each do |branch_name,branch_info| %>
    <% first = branch_info.first %>
    <% first = branch_info[1] if first['status'] == 'canceled' %>
    <% next unless first %>
    <% first = branch_info[2] if first['status'] == 'canceled' %>
    <% next unless first %>
    <% first = branch_info[3] if first['status'] == 'canceled' %>
    <% next unless first %>
    <div class="branch-result <%= first['status'] %>">
      <div class="blame">
        <img src="http://www.gravatar.com/avatar/<%= Digest::MD5.hexdigest(first['committer_email'].to_s.downcase).to_s %>>?s=128" />
      </div>
      <div class="commit-details">
        <h2><%= branch_name[0,50] %></h2>
        <a href="<%= first['build_url'] %>" target="_blank"><%= first['subject'][0,50] %></a>
      </div>
    </div>

  <% end %>
<% end %>
</body>
</html>